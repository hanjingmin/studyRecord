# peter-sun 代码规范

规则 2.1.1



文件头部注释

函数头部注释 

/**

![image-20220720204314688](D:\software\Typora\file\pic\image-20220720204314688.png)

**/





禁止用中文注释



统一采用全小写+下划线的风格进行命名

函数命名规则 主谓宾

基本数据类型 stdtypes.h u8 s8 

宏定义 ((a)*(b))



结构体规则

ASSERT检查传入指针的合法性

高扇入 合理扇出的函数 小于7？？？

扇出是指一个函数直接调用（控制）其它函数的数目，而扇入是指有多少上级函数调用它

私有函数 定义 放到.C文件中 不要放到.H中

extern的引用问题



![image-20220720210819736](D:\software\Typora\file\pic\image-20220720210819736.png)

 循环嵌套小于8层



规则2.13.6 不准用goto语句



eSSD Fireware



#if 0





## NVMe协议 第三章

### CAP寄存器 – Controller Capabilities   

这一寄存器反应了控制器与host软件的基本交互能力。

从00h到63h 

- Memory Page Size Maximum (MPSMAX) --- host在CC.MPS中设置的页大小不应该超过MPSMAX
- Command Sets Supported (CSS) --- 44:37之间，且第44个bit只能为Admin Command Set，不能为NVM command set。
- NVM Subsystem Reset Supported (NSSRS)： 跟PCIe的插槽相关，控制器+nand存储器
- Doorbell Stride (DSTRD): SQ以及CQ Doorbell register都是32bits的。这一寄存器记录了doorbell寄存器之间的步长，公式为 (2^(2 + DSTRD))，为4K的倍数。
- Timeout (TO)
- Arbitration Mechanism Supported (AMS)
- Contiguous Queues Required

#### CC – Controller Configuration  

这一修改器修改寄存器参数。

#### INTMS – Interrupt Mask Set  

- I/O Completion Queue Entry Size (IOCQES)
- I/O Submission Queue Entry Size (IOSQES)
- Shutdown Notification (SHN)
- Arbitration Mechanism Selected (AMS)
- Memory Page Size (MPS)
- I/O Command Set Selected (CSS)
- Enable (EN)

#### CSTS – Controller Status  

- Processing Paused (PP)
- NVM Subsystem Reset Occurred (NSSRO)
- Shutdown Status (SHST)
- Controller Fatal Status (CFS)
- Ready (RDY)

#### NSSR – NVM Subsystem Reset  

- NVM Subsystem Reset Control (NSSRC)

#### AQA – Admin Queue Attributes  

这一寄存器定义了ASQ和ACQ的属性。

- Admin Completion Queue Size (ACQS)
- Admin Submission Queue Size (ASQS)

#### ASQ – Admin Submission Queue Base Address  

- Admin Submission Queue Base (ASQB)
- ACQ – Admin Completion Queue Base Address  





## NVMe协议 第四章 数据结构

这一部分描述了NVMe协议中所用的数据结构。

## 4.1 Submission Queue & Completion Queue Definition  